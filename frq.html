---
layout: none
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FRQ Viewer — AP Calculus AB</title>
  <style>
    /* Global reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #f5f7fa;
      color: #2d3748;
      padding: 0;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* FRQ Viewer Styles */
    :root {
      --sidebar-width: 300px;
      --gap: 16px;
      --bg: #ffffff;
      --panel: #f8f9fa;
      --text: #2d3748;
      --muted: #718096;
      --accent: #667eea;
      --accent-hover: #764ba2;
      --success: #48bb78;
      --warning: #ed8936;
    }

    /* Hero Section */
    .frq-hero {
      background: #2d3748;
      padding: 60px 20px 80px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .frq-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      opacity: 0;
    }

    .frq-hero-content {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: 0 auto;
    }

    .frq-hero h1 {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 800;
      margin-bottom: 16px;
      color: white;
      text-shadow: 0 2px 20px rgba(0,0,0,0.2);
      letter-spacing: -0.02em;
    }

    .frq-hero .subtitle {
      font-size: clamp(1rem, 2.5vw, 1.25rem);
      color: rgba(255,255,255,0.95);
      margin-bottom: 32px;
      font-weight: 500;
    }

    .frq-stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
      margin-top: 40px;
    }

    .frq-stat {
      text-align: center;
    }

    .frq-stat-number {
      font-size: 2.5rem;
      font-weight: 800;
      color: white;
      display: block;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .frq-stat-label {
      font-size: 0.9rem;
      color: rgba(255,255,255,0.9);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .frq-app {
      display: grid;
      grid-template-columns: var(--sidebar-width) 1fr;
      gap: var(--gap);
      min-height: calc(100vh - 240px);
      max-width: 1600px;
      margin: -40px auto 0;
      padding: 0 20px 40px;
      position: relative;
      z-index: 2;
    }

    .frq-sidebar {
      background: white;
      border-radius: 16px;
      padding: 20px;
      color: var(--text);
      max-height: calc(100vh - 180px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    }

    .frq-sidebar-header {
      display: grid;
      gap: 12px;
      padding: 0 0 16px 0;
      border-bottom: 2px solid #e2e8f0;
      margin-bottom: 16px;
    }

    .frq-sidebar-header h2 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
    }

    .frq-filter {
      width: 100%;
      padding: 10px 14px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      background: white;
      color: var(--text);
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .frq-filter:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .frq-menu {
      margin-top: 8px;
      overflow: auto;
    }

    .frq-year {
      margin: 8px 0;
      background: #f7fafc;
      border-radius: 12px;
      border: 2px solid transparent;
      transition: all 0.2s ease;
    }

    .frq-year:hover {
      border-color: var(--accent);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.15);
    }

    .frq-year summary {
      cursor: pointer;
      padding: 12px 14px;
      font-weight: 700;
      list-style: none;
      user-select: none;
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-radius: 10px;
    }

    .frq-year summary::after {
      content: '▼';
      font-size: 0.7rem;
      color: var(--muted);
      transition: transform 0.2s ease;
    }

    .frq-year[open] summary::after {
      transform: rotate(180deg);
    }

    .frq-year summary::-webkit-details-marker { display: none; }
    .frq-year summary::marker { content: ''; }

    .frq-year[open] .frq-q-list { display: grid; }
    .frq-year:not([open]) .frq-q-list { display: none; }

    .frq-q-list {
      padding: 12px;
      grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
      gap: 8px;
    }

    .frq-q-btn {
      padding: 10px;
      border: 2px solid #e2e8f0;
      background: white;
      color: var(--text);
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .frq-q-btn:hover { 
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    .frq-q-btn[aria-current="true"] {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    /* Main viewer */
    .frq-view {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .frq-view-header {
      background: white;
      padding: 24px 28px;
      border-radius: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      border: 2px solid #e2e8f0;
    }

    .frq-title {
      font-size: 1.5rem;
      font-weight: 800;
      color: var(--text);
    }

    .frq-subtitle {
      font-size: 0.95rem;
      color: var(--muted);
      margin-top: 4px;
      font-weight: 500;
    }

    .frq-controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .frq-btn {
      padding: 12px 20px;
      border: 2px solid var(--accent);
      background: white;
      color: var(--accent);
      font-size: 0.95rem;
      font-weight: 600;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .frq-btn:hover:not(:disabled) {
      background: var(--accent);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    .frq-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      border-color: #cbd5e0;
      color: #cbd5e0;
    }

    #answer-btn {
      background: var(--success);
      color: white;
      border-color: var(--success);
    }

    #answer-btn:hover:not(:disabled) {
      background: #38a169;
      box-shadow: 0 4px 12px rgba(72, 187, 120, 0.4);
    }

    .frq-canvas {
      background: white;
      border-radius: 16px;
      padding: 32px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 600px;
      overflow: auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      border: 2px solid #e2e8f0;
    }

    .frq-placeholder {
      color: var(--muted);
      font-size: 1.2rem;
      text-align: center;
      font-weight: 500;
    }

    .frq-img-wrap {
      display: flex;
      flex-direction: column;
      gap: 32px;
      align-items: center;
      max-width: 100%;
      width: 100%;
    }

    .frq-img-wrap img {
      max-width: 1100px;
      width: 100%;
      height: auto;
      max-height: 80vh;
      object-fit: contain;
      background: white;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      transition: transform 0.2s ease;
    }

    .frq-img-wrap img:hover {
      transform: scale(1.01);
    }

    .frq-answer-img { 
      margin-top: 20px;
      max-width: 1400px !important;
      max-height: 90vh !important;
      border: 3px solid var(--success);
    }

    .frq-answer-img.hidden {
      display: none;
    }

    /* Keyboard focus helper */
    .user-is-tabbing .frq-q-btn:focus,
    .user-is-tabbing .frq-btn:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* Back to home link */
    .frq-back-link {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
      background: white;
      color: var(--accent);
      padding: 10px 20px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .frq-back-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
      background: var(--accent);
      color: white;
    }

    /* Mobile */
    @media (max-width: 900px) {
      .frq-hero {
        padding: 40px 16px 60px;
      }

      .frq-hero h1 {
        font-size: 1.75rem;
        line-height: 1.2;
      }

      .frq-hero .subtitle {
        font-size: 1rem;
      }

      .frq-stats {
        gap: 20px;
      }

      .frq-stat-number {
        font-size: 2rem;
      }

      .frq-stat-label {
        font-size: 0.8rem;
      }

      .frq-app { 
        grid-template-columns: 1fr;
        margin-top: -20px;
        padding: 0 12px 24px;
      }
      
      .frq-sidebar { 
        max-height: none;
        margin-bottom: 16px;
        padding: 16px;
      }

      .frq-sidebar-header h2 {
        font-size: 1rem;
      }

      .frq-filter {
        font-size: 0.9rem;
        padding: 8px 12px;
      }

      .frq-year summary {
        padding: 10px 12px;
        font-size: 0.95rem;
      }

      .frq-q-list {
        padding: 8px;
        grid-template-columns: repeat(auto-fill, minmax(45px, 1fr));
        gap: 6px;
      }

      .frq-q-btn {
        padding: 8px;
        font-size: 0.85rem;
      }

      .frq-view-header {
        padding: 16px;
        gap: 12px;
      }

      .frq-title {
        font-size: 1.2rem;
      }

      .frq-subtitle {
        font-size: 0.85rem;
      }

      .frq-canvas {
        padding: 16px;
        min-height: 400px;
      }

      .frq-controls {
        width: 100%;
        gap: 8px;
      }

      .frq-btn {
        flex: 1;
        justify-content: center;
        padding: 10px 12px;
        font-size: 0.85rem;
      }

      .frq-img-wrap {
        gap: 20px;
      }

      .frq-img-wrap img {
        border-radius: 8px;
      }
    }

    /* Extra small mobile */
    @media (max-width: 480px) {
      .frq-hero h1 {
        font-size: 1.5rem;
      }

      .frq-stats {
        gap: 16px;
      }

      .frq-stat-number {
        font-size: 1.75rem;
      }

      .frq-q-list {
        grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
      }

      .frq-controls {
        flex-direction: column;
      }

      .frq-btn {
        width: 100%;
      }
    }
  </style>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-LGGRY4GEMV"></script>
</head>
<body>

<!-- Hero Section -->
<section class="frq-hero">
  <div class="frq-hero-content">
    <h1>AP Calculus AB FRQ Viewer</h1>
    <p class="subtitle">Master every Free Response Question from 2003-2024 with instant access to official solutions</p>
    
    <div class="frq-stats">
      <div class="frq-stat">
        <span class="frq-stat-number">180</span>
        <span class="frq-stat-label">Questions</span>
      </div>
      <div class="frq-stat">
        <span class="frq-stat-number">23</span>
        <span class="frq-stat-label">Years</span>
      </div>
      <div class="frq-stat">
        <span class="frq-stat-number">100%</span>
        <span class="frq-stat-label">Free</span>
      </div>
    </div>
  </div>
</section>

<div id="frq-app" class="frq-app">
  <aside class="frq-sidebar">
    <div class="frq-sidebar-header">
      <h2>Years & Questions</h2>
      <input id="frq-filter" class="frq-filter" placeholder="Filter by year…" aria-label="Filter by year" />
    </div>
    <nav id="frq-menu" class="frq-menu" aria-label="FRQ year and question selector">
      <!-- Populated by JS -->
    </nav>
  </aside>

  <main class="frq-view">
    <header class="frq-view-header">
      <div>
        <h1 id="frq-title" class="frq-title">Select a question</h1>
        <p id="frq-subtitle" class="frq-subtitle">Use the sidebar to choose a year and question.</p>
      </div>
      <div class="frq-controls">
        <button id="prev-btn" class="frq-btn" title="Previous (←)">Prev</button>
        <button id="next-btn" class="frq-btn" title="Next (→)">Next</button>
        <button id="answer-btn" class="frq-btn" disabled>Show Answer</button>
      </div>
    </header>

    <section class="frq-canvas" id="frq-canvas" aria-live="polite">
      <!-- Question/answer images go here -->
      <div id="frq-placeholder" class="frq-placeholder">Choose a year and question to begin practicing.</div>
    </section>
  </main>
</div>

<script>
// Accessibility helper: focus outline for keyboard nav
document.addEventListener('keydown', (e) => {
  if (e.key === 'Tab') document.documentElement.classList.add('user-is-tabbing');
});
document.addEventListener('mousedown', () => document.documentElement.classList.remove('user-is-tabbing'));

// FRQ Viewer Logic
const dataUrl = '/frqviewer/frqs.json';

(async function init() {
  try {
    const res = await fetch(dataUrl);
    if (!res.ok) throw new Error(`Failed to load frqs.json: ${res.status} ${res.statusText}`);
    const questions = await res.json();
    
    console.log(`Loaded ${questions.length} questions`);
    bootstrapUI(questions);
  } catch (err) {
    console.error(err);
    const canvas = document.getElementById('frq-canvas');
    if (canvas) canvas.innerHTML = `<p style="color: #b00;">Unable to load questions: ${err.message}</p>`;
  }
})();

function bootstrapUI(questions) {
  // Normalize and index questions - extract question number from URL
  const normal = questions.map(q => {
    const qNum = extractQNum(q.questionImage);
    console.log(`Question ${q.id}: year=${q.year}, qNum=${qNum}, hasAnswer=${!!q.answerImage}`);
    return {
      ...q,
      qNum: qNum || 0
    };
  });

  const byYear = groupBy(normal, q => q.year);

  // Elements
  const menu = document.getElementById('frq-menu');
  const filter = document.getElementById('frq-filter');
  const title = document.getElementById('frq-title');
  const subtitle = document.getElementById('frq-subtitle');
  const canvas = document.getElementById('frq-canvas');
  const answerBtn = document.getElementById('answer-btn');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');

  let currentIndex = -1; // index in normal[]
  let answerVisible = false;

  // Build sidebar
  renderMenu(byYear, menu, (year, qNum) => {
    const idx = normal.findIndex(q => q.year === year && q.qNum === qNum);
    if (idx >= 0) selectIndex(idx);
  });

  // Filter by year
  filter?.addEventListener('input', () => {
    const query = filter.value.trim();
    const yearFilter = query ? new RegExp(query.replace(/[^0-9B]/gi,''), 'i') : null;
    for (const section of menu.querySelectorAll('.frq-year')) {
      const y = section.dataset.year;
      section.style.display = yearFilter ? (String(y).match(yearFilter) ? '' : 'none') : '';
    }
  });

  // Navigation
  prevBtn?.addEventListener('click', () => selectIndex(Math.max(0, currentIndex - 1)));
  nextBtn?.addEventListener('click', () => selectIndex(Math.min(normal.length - 1, currentIndex + 1)));
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') prevBtn?.click();
    if (e.key === 'ArrowRight') nextBtn?.click();
  });

  answerBtn?.addEventListener('click', () => toggleAnswer());

  // Select the first item by default
  if (normal.length) selectIndex(0);

  function selectIndex(idx) {
    currentIndex = idx;
    const q = normal[idx];
    answerVisible = false;
    
    // Update header
    const isFormB = q.year.includes('B');
    const formLabel = isFormB ? ' (Form B)' : '';
    title.textContent = `${q.year}${formLabel} — Question ${q.qNum || '?'}`;
    subtitle.textContent = q.topic ? q.topic : 'AP Calculus AB';

    // Update viewer
    renderQuestion(canvas, q, answerBtn);

    // Enable/disable nav
    prevBtn.disabled = idx <= 0;
    nextBtn.disabled = idx >= normal.length - 1;

    // Update button text with arrows
    prevBtn.innerHTML = '← Previous';
    nextBtn.innerHTML = 'Next →';

    // Highlight current in menu
    menu.querySelectorAll('.frq-q-btn[aria-current="true"]').forEach(el => el.setAttribute('aria-current','false'));
    const btn = menu.querySelector(`.frq-q-btn[data-year="${q.year}"][data-qnum="${q.qNum}"]`);
    if (btn) btn.setAttribute('aria-current','true');
  }

  function toggleAnswer() {
    const q = normal[currentIndex];
    if (!q) {
      console.error('No question selected');
      return;
    }
    
    if (!q.answerImage || q.answerImage.trim() === '') {
      console.warn('No answer image available for:', q);
      return;
    }
    
    const wrap = canvas.querySelector('.frq-img-wrap');
    if (!wrap) {
      console.error('Cannot find .frq-img-wrap container');
      return;
    }
    
    const answerImg = wrap.querySelector('img.frq-answer-img');
    if (!answerImg) {
      // Create answer image if it doesn't exist
      const img = document.createElement('img');
      img.className = 'frq-answer-img';
      img.alt = `Answer for ${q.year} Question ${q.qNum}`;
      img.src = q.answerImage;
      img.onerror = () => {
        console.error('Failed to load answer image:', q.answerImage);
        img.remove();
        toast(canvas, `Could not load answer image. Please check if the file exists at: ${q.answerImage}`);
        answerBtn.disabled = true;
        answerBtn.textContent = 'Answer Unavailable';
      };
      img.onload = () => {
        console.log('Answer image loaded successfully:', q.answerImage);
      };
      wrap.appendChild(img);
      answerVisible = true;
      answerBtn.textContent = 'Hide Answer';
    } else {
      // Toggle visibility
      answerVisible = !answerVisible;
      if (answerVisible) {
        answerImg.classList.remove('hidden');
        answerBtn.textContent = 'Hide Answer';
      } else {
        answerImg.classList.add('hidden');
        answerBtn.textContent = 'Show Answer';
      }
    }
  }
}

function renderMenu(byYear, menuEl, onPick) {
  menuEl.innerHTML = '';
  const years = Array.from(byYear.keys()).sort((a, b) => {
    // Sort year strings naturally: "2003" < "2003B" < "2004" < "2004B"
    const numA = parseInt(a);
    const numB = parseInt(b);
    if (numA !== numB) return numA - numB;
    return a.localeCompare(b);
  });
  
  for (const y of years) {
    const section = document.createElement('details');
    section.className = 'frq-year';
    section.dataset.year = String(y);
    // Expand the most recent year by default
    if (y === years[years.length-1]) section.open = true;

    const sum = document.createElement('summary');
    sum.textContent = String(y);
    section.appendChild(sum);

    const list = document.createElement('div');
    list.className = 'frq-q-list';
    const items = byYear.get(y).slice().sort((a,b) => a.qNum - b.qNum);
    for (const q of items) {
      const btn = document.createElement('button');
      btn.className = 'frq-q-btn';
      btn.type = 'button';
      btn.textContent = `Q${q.qNum || '?'}`;
      btn.dataset.year = String(y);
      btn.dataset.qnum = String(q.qNum || '');
      btn.addEventListener('click', () => onPick(y, q.qNum));
      list.appendChild(btn);
    }
    section.appendChild(list);
    menuEl.appendChild(section);
  }
}

function renderQuestion(canvas, q, answerBtn) {
  canvas.innerHTML = '';
  const wrap = document.createElement('div');
  wrap.className = 'frq-img-wrap';

  const img = document.createElement('img');
  img.alt = `FRQ ${q.year} Question ${q.qNum}`;
  img.src = q.questionImage;
  img.onerror = () => {
    wrap.innerHTML = '';
    toast(canvas, 'Question image could not be loaded.');
  };
  wrap.appendChild(img);
  canvas.appendChild(wrap);

  // Answer button state - check if answerImage exists and is not empty
  if (answerBtn) {
    const hasAnswer = q.answerImage && typeof q.answerImage === 'string' && q.answerImage.trim().length > 0;
    answerBtn.disabled = !hasAnswer;
    answerBtn.textContent = 'Show Answer';
    
    console.log(`Question ${q.id} (${q.year} Q${q.qNum}): answerImage=${q.answerImage}, hasAnswer=${hasAnswer}`);
    
    if (!hasAnswer) {
      console.warn(`⚠️ No answer image for question ${q.id}, year ${q.year}, qNum ${q.qNum}`);
      answerBtn.title = 'Answer not available for this question';
    } else {
      console.log(`✅ Answer available: ${q.answerImage}`);
      answerBtn.title = 'Click to show answer';
    }
  }
}

function extractQNum(url) {
  if (!url) return null;
  const m = String(url).match(/Q(\d+)/i);
  return m ? Number(m[1]) : null;
}

function groupBy(arr, keyFn) {
  const map = new Map();
  for (const item of arr) {
    const k = keyFn(item);
    if (!map.has(k)) map.set(k, []);
    map.get(k).push(item);
  }
  return map;
}

function toast(container, msg) {
  const p = document.createElement('p');
  p.style.color = '#b00';
  p.style.padding = '10px';
  p.textContent = msg;
  container.appendChild(p);
}
</script>

</body>
</html>
