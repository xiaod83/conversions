---
layout: none
---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FRQ Viewer — AP Calculus AB</title>
  <style>
    /* Global reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: #0a0c10;
      color: #e6e6e6;
      padding: 20px;
      line-height: 1.5;
    }

    /* FRQ Viewer Styles */
    :root {
      --sidebar-width: 280px;
      --gap: 12px;
      --bg: #0f1115;
      --panel: #151923;
      --text: #e6e6e6;
      --muted: #9aa0a6;
      --accent: #4f8cff;
    }

    .frq-app {
      display: grid;
      grid-template-columns: var(--sidebar-width) 1fr;
      gap: var(--gap);
      min-height: 85vh;
      max-width: 1600px;
      margin: 0 auto;
    }

    .frq-sidebar {
      background: var(--panel);
      border-radius: 10px;
      padding: 10px;
      color: var(--text);
      max-height: calc(100vh - 60px);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .frq-sidebar-header {
      display: grid;
      gap: 8px;
      padding: 4px 2px 8px 2px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .frq-sidebar-header h2 {
      font-size: 1rem;
      font-weight: 600;
    }

    .frq-filter {
      width: 100%;
      padding: 6px 10px;
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 6px;
      background: #0e1218;
      color: var(--text);
      font-size: 0.9rem;
    }

    .frq-menu {
      margin-top: 8px;
      overflow: auto;
    }

    .frq-year {
      margin: 6px 0;
      background: rgba(255,255,255,0.04);
      border-radius: 8px;
    }

    .frq-year summary {
      cursor: pointer;
      padding: 8px 10px;
      font-weight: 600;
      list-style: none;
      user-select: none;
    }
    .frq-year summary::-webkit-details-marker { display: none; }
    .frq-year summary::marker { content: ''; }

    .frq-year[open] .frq-q-list { display: grid; }
    .frq-year:not([open]) .frq-q-list { display: none; }

    .frq-q-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      padding: 8px;
    }

    .frq-q-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 6px 8px;
      border-radius: 6px;
      background: #0e1218;
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.15);
      cursor: pointer;
      font-size: 0.85rem;
    }
    .frq-q-btn:hover { background: #1a1f2a; }
    .frq-q-btn[aria-current="true"] {
      outline: 2px solid var(--accent);
      background: #1a2332;
    }

    .frq-view {
      background: var(--bg);
      border-radius: 10px;
      color: var(--text);
      padding: 10px;
      min-height: 85vh;
      display: flex;
      flex-direction: column;
    }

    .frq-view-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .frq-title {
      margin: 0;
      font-size: 1.25rem;
    }
    .frq-subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .frq-controls { display: flex; gap: 6px; }
    .frq-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: #202734;
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    .frq-btn:hover:not(:disabled) { background: #2a3444; }
    .frq-btn:disabled { opacity: 0.5; cursor: default; }

    .frq-canvas {
      margin-top: 10px;
      flex: 1;
      position: relative;
      background: #0c0f14;
      border-radius: 8px;
      display: grid;
      place-items: center;
      overflow: auto;
    }

    .frq-placeholder { color: var(--muted); }

    .frq-img-wrap {
      max-width: 100%;
      max-height: 100%;
      display: grid;
      place-items: center;
      padding: 8px;
    }

    .frq-img-wrap img {
      max-width: min(1100px, 100%);
      max-height: 80vh;
      width: auto;
      height: auto;
      object-fit: contain;
      background: white;
      box-shadow: 0 2px 12px rgba(0,0,0,0.4);
      border-radius: 4px;
    }

    .frq-answer-img { margin-top: 10px; }

    /* Keyboard focus helper */
    .user-is-tabbing .frq-q-btn:focus,
    .user-is-tabbing .frq-btn:focus {
      outline: 2px solid var(--accent);
      outline-offset: 2px;
    }

    /* Mobile */
    @media (max-width: 900px) {
      .frq-app { grid-template-columns: 1fr; }
      .frq-sidebar { max-height: none; }
    }
  </style>
</head>
<body>

<div id="frq-app" class="frq-app">
  <aside class="frq-sidebar">
    <div class="frq-sidebar-header">
      <h2>Years & Questions</h2>
      <input id="frq-filter" class="frq-filter" placeholder="Filter by year…" aria-label="Filter by year" />
    </div>
    <nav id="frq-menu" class="frq-menu" aria-label="FRQ year and question selector">
      <!-- Populated by JS -->
    </nav>
  </aside>

  <main class="frq-view">
    <header class="frq-view-header">
      <div>
        <h1 id="frq-title" class="frq-title">Select a question</h1>
        <p id="frq-subtitle" class="frq-subtitle">Use the sidebar to choose a year and question.</p>
      </div>
      <div class="frq-controls">
        <button id="prev-btn" class="frq-btn" title="Previous (←)">Prev</button>
        <button id="next-btn" class="frq-btn" title="Next (→)">Next</button>
        <button id="answer-btn" class="frq-btn" disabled>Show Answer</button>
      </div>
    </header>

    <section class="frq-canvas" id="frq-canvas" aria-live="polite">
      <!-- Question/answer images go here -->
      <div id="frq-placeholder" class="frq-placeholder">Choose a year and question to begin.</div>
    </section>
  </main>
</div>

<script>
// Accessibility helper: focus outline for keyboard nav
document.addEventListener('keydown', (e) => {
  if (e.key === 'Tab') document.documentElement.classList.add('user-is-tabbing');
});
document.addEventListener('mousedown', () => document.documentElement.classList.remove('user-is-tabbing'));

// FRQ Viewer Logic
const dataUrl = '/frqviewer/frqs.json';

(async function init() {
  try {
    const res = await fetch(dataUrl);
    if (!res.ok) throw new Error(`Failed to load frqs.json: ${res.status} ${res.statusText}`);
    const questions = await res.json();

    bootstrapUI(questions);
  } catch (err) {
    console.error(err);
    const canvas = document.getElementById('frq-canvas');
    if (canvas) canvas.innerHTML = `<p style="color: #b00;">Unable to load questions: ${err.message}</p>`;
  }
})();

function bootstrapUI(questions) {
  // Normalize and index questions
  const normal = questions.map(q => ({
    ...q,
    qNum: extractQNum(q.questionImage) || 0
  }));

  const byYear = groupBy(normal, q => q.year);

  // Elements
  const menu = document.getElementById('frq-menu');
  const filter = document.getElementById('frq-filter');
  const title = document.getElementById('frq-title');
  const subtitle = document.getElementById('frq-subtitle');
  const canvas = document.getElementById('frq-canvas');
  const answerBtn = document.getElementById('answer-btn');
  const prevBtn = document.getElementById('prev-btn');
  const nextBtn = document.getElementById('next-btn');

  let currentIndex = -1; // index in normal[]

  // Build sidebar
  renderMenu(byYear, menu, (year, qNum) => {
    const idx = normal.findIndex(q => q.year === year && q.qNum === qNum);
    if (idx >= 0) selectIndex(idx);
  });

  // Filter by year
  filter?.addEventListener('input', () => {
    const query = filter.value.trim();
    const yearFilter = query ? new RegExp(query.replace(/[^0-9B]/gi,''), 'i') : null;
    for (const section of menu.querySelectorAll('.frq-year')) {
      const y = section.dataset.year;
      section.style.display = yearFilter ? (String(y).match(yearFilter) ? '' : 'none') : '';
    }
  });

  // Navigation
  prevBtn?.addEventListener('click', () => selectIndex(Math.max(0, currentIndex - 1)));
  nextBtn?.addEventListener('click', () => selectIndex(Math.min(normal.length - 1, currentIndex + 1)));
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') prevBtn?.click();
    if (e.key === 'ArrowRight') nextBtn?.click();
  });

  answerBtn?.addEventListener('click', () => showAnswer());

  // Select the first item by default
  if (normal.length) selectIndex(0);

  function selectIndex(idx) {
    currentIndex = idx;
    const q = normal[idx];
    // Update header
    const isFormB = q.year.includes('B');
    const formLabel = isFormB ? ' (Form B)' : '';
    title.textContent = `Year ${q.year}${formLabel} — Question ${q.qNum || '?'}`;
    subtitle.textContent = q.topic ? q.topic : 'AP Calculus AB';

    // Update viewer
    renderQuestion(canvas, q, answerBtn);

    // Enable/disable nav
    prevBtn.disabled = idx <= 0;
    nextBtn.disabled = idx >= normal.length - 1;

    // Highlight current in menu
    menu.querySelectorAll('.frq-q-btn[aria-current="true"]').forEach(el => el.setAttribute('aria-current','false'));
    const btn = menu.querySelector(`.frq-q-btn[data-year="${q.year}"][data-qnum="${q.qNum}"][data-formb="${q.isFormB}"]`);
    if (btn) btn.setAttribute('aria-current','true');
  }

  function showAnswer() {
    const q = normal[currentIndex];
    if (!q || !q.answerImage) return;
    const answerImg = canvas.querySelector('img.frq-answer-img');
    if (answerImg) return; // already displayed

    const img = document.createElement('img');
    img.className = 'frq-answer-img';
    img.alt = `Answer ${q.id || ''}`.trim();
    img.src = q.answerImage;
    img.onload = () => img.style.display = '';
    img.onerror = () => {
      img.remove();
      toast(canvas, 'Answer image could not be loaded.');
      answerBtn.disabled = false;
    };
    canvas.querySelector('.frq-img-wrap')?.appendChild(img);
    answerBtn.disabled = true;
  }
}

function renderMenu(byYear, menuEl, onPick) {
  menuEl.innerHTML = '';
  const years = Array.from(byYear.keys()).sort((a, b) => {
    // Sort year strings naturally: "2003" < "2003B" < "2004" < "2004B"
    const numA = parseInt(a);
    const numB = parseInt(b);
    if (numA !== numB) return numA - numB;
    return a.localeCompare(b);
  });
  
  for (const y of years) {
    const section = document.createElement('details');
    section.className = 'frq-year';
    section.dataset.year = String(y);
    // Expand the most recent year by default
    if (y === years[years.length-1]) section.open = true;

    const sum = document.createElement('summary');
    sum.textContent = String(y);
    section.appendChild(sum);

    const list = document.createElement('div');
    list.className = 'frq-q-list';
    const items = byYear.get(y).slice().sort((a,b) => a.qNum - b.qNum);
    for (const q of items) {
      const btn = document.createElement('button');
      btn.className = 'frq-q-btn';
      btn.type = 'button';
      btn.textContent = `Q${q.qNum || '?'}`;
      btn.dataset.year = String(y);
      btn.dataset.qnum = String(q.qNum || '');
      btn.addEventListener('click', () => onPick(y, q.qNum));
      list.appendChild(btn);
    }
    section.appendChild(list);
    menuEl.appendChild(section);
  }
}

function renderQuestion(canvas, q, answerBtn) {
  canvas.innerHTML = '';
  const wrap = document.createElement('div');
  wrap.className = 'frq-img-wrap';

  const img = document.createElement('img');
  img.alt = `FRQ ${q.id || ''}`.trim();
  img.src = q.questionImage;
  img.onerror = () => {
    wrap.innerHTML = '';
    toast(canvas, 'Question image could not be loaded.');
  };
  wrap.appendChild(img);
  canvas.appendChild(wrap);

  // Answer button state
  if (answerBtn) {
    answerBtn.disabled = !q.answerImage;
  }
}

function extractQNum(url) {
  if (!url) return null;
  const m = String(url).match(/Q(\d+)/i);
  return m ? Number(m[1]) : null;
}

function groupBy(arr, keyFn) {
  const map = new Map();
  for (const item of arr) {
    const k = keyFn(item);
    if (!map.has(k)) map.set(k, []);
    map.get(k).push(item);
  }
  return map;
}

function toast(container, msg) {
  const p = document.createElement('p');
  p.style.color = '#b00';
  p.style.padding = '10px';
  p.textContent = msg;
  container.appendChild(p);
}
</script>

</body>
</html>